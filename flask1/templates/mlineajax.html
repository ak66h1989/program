
<input type="checkbox" id="chk-sync" onchange="update()"><label for="chk-sync">Sync</label>
<script>
var sync;
var gs;

window.update = function() {
    var chk = document.getElementById('chk-sync').checked;

    if(chk) {
        sync = Dygraph.synchronize(gs,{range: false});
    }
    else {
        sync.detach();
	    for (i = 0; i < gs.length; ++i) {
			gs[i].updateOptions({
                dateWindow: null,
			    valueRange: null
		    });
        }
    }
}
</script>

<script type=text/javascript>
if (!String.prototype.format) {
    String.prototype.format = function() {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function(match, number) {
        return typeof args[number] != 'undefined'
          ? args[number]
          : match
        ;
        });
    };
}
var i=0;
gs = [];
$(function() {
    $('#mline').on('click', function() {

        var d=`<div id = "dy{0}" className="few" style="width:{1}px;height:{2}px;"></div>
        <form>
          <input type="button" name="dy{0}" value="raw"/>
          <input type="button" name="dy{0}" value="normalize"/>
          <input type="button" name="dy{0}" value="remove"/>
        </form>`.format(i, $('#mlineform input[name="width"]').val(), $('#mlineform input[name="height"]').val());      //use button instead of submit or the page will reload

        $('#tabs-2').append(d);
        $("#tabs-2 form").on('click', 'input', scaleajax);
        $('#tabs a[href="#tabs-2"]').click();
        var id = 'dy'+i;
        $.getJSON($SCRIPT_ROOT + '/mlineajax/', {
        data: $("#mlineform").serialize(),
        }, function(data) {
            gs.push(new Dygraph(document.getElementById(id),
            data.data,
            {
            labels: data.labels,
            axes: {
                x: {
                    valueFormatter: Dygraph.dateString_,
                    axisLabelFormatter: Dygraph.dateAxisFormatter,
                    ticker: Dygraph.dateTicker
                }
            },
            highlightSeriesOpts: {
            strokeWidth: 1,
            strokeBorderWidth: 1,
            highlightCircleSize: 5
            },
            showRangeSelector: data.rangeselector,
            interactionModel: Dygraph.defaultInteractionModel,
            legend: 'follow',
            labelsSeparateLines:true,
            connectSeparatedPoints:true
            }));
        });
    i+=1;
    return false;
    });
});
</script>
<script>

function scaleajax(){
    if ($(this).attr('value')=="remove"){
        $(this).parent().remove();
        $('#'+$(this).attr('name')).remove();
        $.getJSON($SCRIPT_ROOT + '/scaleajax/', {
        name: $(this).attr('name'),
        value: $(this).attr('value')
        }, function(data) {
            new Dygraph(document.getElementById(data.j),
            data.data,
            {
            labels: data.labels,
            axes: {
                x: {
                    valueFormatter: Dygraph.dateString_,
                    axisLabelFormatter: Dygraph.dateAxisFormatter,
                    ticker: Dygraph.dateTicker
                }
            },
            highlightSeriesOpts: {
            strokeWidth: 1,
            strokeBorderWidth: 1,
            highlightCircleSize: 5
            },
            showRangeSelector: data.rangeselector,
            interactionModel: Dygraph.defaultInteractionModel,
            legend: 'follow',
            labelsSeparateLines:true,
            connectSeparatedPoints:true
            });
            //gs.splice(data.i,1);
        });
    }else{
        $.getJSON($SCRIPT_ROOT + '/scaleajax/', {
        name: $(this).attr('name'),
        value: $(this).attr('value')
        }, function(data) {
            gs[data.i]=new Dygraph(document.getElementById(data.j),
            data.data,
            {
            labels: data.labels,
            axes: {
                x: {
                    valueFormatter: Dygraph.dateString_,
                    axisLabelFormatter: Dygraph.dateAxisFormatter,
                    ticker: Dygraph.dateTicker
                }
            },
            highlightSeriesOpts: {
            strokeWidth: 1,
            strokeBorderWidth: 1,
            highlightCircleSize: 5
            },
            showRangeSelector: data.rangeselector,
            interactionModel: Dygraph.defaultInteractionModel,
            legend: 'follow',
            labelsSeparateLines:true,
            connectSeparatedPoints:true
            });
        });
    }
}

</script>
